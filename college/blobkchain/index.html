

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.png">
  <link rel="icon" href="/img/favicon.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="JackZhu">
  <meta name="keywords" content="">
  
    <meta name="description" content="为了开展我的个人项目，第一周的任务是学习区块链的背景知识，了解zkSync的basic idea。 区块链区块链是站在巨人的肩膀上的：  1982年，David Chaum提出了注重隐私安全的密码学网络支付系统 1985年，Neal Koblitz和Victor Miller各自独立提出著名的椭圆曲线加密算法 1991年，Stuart Haber和W. Scott Stornetta提出用时间戳确">
<meta property="og:type" content="article">
<meta property="og:title" content="区块链学习笔记">
<meta property="og:url" content="http://example.com/college/blobkchain/index.html">
<meta property="og:site_name" content="JackZhu&#39;s Blog">
<meta property="og:description" content="为了开展我的个人项目，第一周的任务是学习区块链的背景知识，了解zkSync的basic idea。 区块链区块链是站在巨人的肩膀上的：  1982年，David Chaum提出了注重隐私安全的密码学网络支付系统 1985年，Neal Koblitz和Victor Miller各自独立提出著名的椭圆曲线加密算法 1991年，Stuart Haber和W. Scott Stornetta提出用时间戳确">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://s4.ax1x.com/2022/03/02/b8Y1Fx.jpg">
<meta property="og:image" content="c:/Users/JackZhu/AppData/Roaming/Typora/typora-user-images/image-20220310130157561.png">
<meta property="og:image" content="c:/Users/JackZhu/AppData/Roaming/Typora/typora-user-images/image-20220310130130956.png">
<meta property="og:image" content="c:/Users/JackZhu/AppData/Roaming/Typora/typora-user-images/image-20220310131320802.png">
<meta property="og:image" content="c:/Users/JackZhu/AppData/Roaming/Typora/typora-user-images/image-20220310132852516.png">
<meta property="article:published_time" content="2022-02-26T02:11:55.000Z">
<meta property="article:modified_time" content="2022-09-01T12:41:22.197Z">
<meta property="article:author" content="JackZhu">
<meta property="article:tag" content="区块链, 比特币, 以太坊">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://s4.ax1x.com/2022/03/02/b8Y1Fx.jpg">
  
  
  <title>区块链学习笔记 - JackZhu&#39;s Blog</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4/github-markdown.min.css" />
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hint.css@2/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10/styles/github-gist.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.css" />
  


<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.8.14","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":"PWUY6L4sCMxvtPwVBSD0BIvw-MdYXbMMI","app_key":"XY7eP0VTgdPSguOqoldnhp5e","server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 6.0.0"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Jack Zhu</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('/img/bg/wallhaven-57jlo1_1280x720.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="区块链学习笔记">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2022-02-26 10:11" pubdate>
        2022年2月26日 上午
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      10k 字
    </span>
  

  
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      84 分钟
    </span>
  

  
  
    
      <!-- LeanCloud 统计文章PV -->
      <span id="leancloud-page-views-container" class="post-meta" style="display: none">
        <i class="iconfont icon-eye" aria-hidden="true"></i>
        <span id="leancloud-page-views"></span> 次
      </span>
    
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">区块链学习笔记</h1>
            
              <p class="note note-info">
                
                  本文最后更新于：2022年9月1日 晚上
                
              </p>
            
            <div class="markdown-body">
              <p>为了开展我的个人项目，第一周的任务是学习区块链的背景知识，了解zkSync的basic idea。</p>
<h1 id="区块链"><a href="#区块链" class="headerlink" title="区块链"></a>区块链</h1><p>区块链是站在巨人的肩膀上的：</p>
<ul>
<li>1982年，David Chaum提出了注重隐私安全的密码学网络支付系统</li>
<li>1985年，Neal Koblitz和Victor Miller各自独立提出著名的椭圆曲线加密算法</li>
<li>1991年，Stuart Haber和W. Scott Stornetta提出用时间戳确保数位文件安全的协议</li>
<li>1997年，Adam Back发明了Hashcash（哈希现金），采用工作量证明演算法（PoW）</li>
<li>1998年，Wei Dai发表了匿名的分散式电子现金系统B-money</li>
<li>2001年，NSA发布SHA-2系列算法，其中包括比特币最终采用的SHA-256哈希算法</li>
</ul>
<p>至此，区块链技术依赖的所有技术基础都具备了</p>
<h2 id="加密算法"><a href="#加密算法" class="headerlink" title="加密算法"></a>加密算法</h2><h3 id="非对称加密算法"><a href="#非对称加密算法" class="headerlink" title="非对称加密算法"></a>非对称加密算法</h3><ul>
<li>RSA：基于大整数分解</li>
<li>ECC：基于椭圆曲线</li>
</ul>
<p>区块链中常用算法是ECC，因为它更难破解。破解228比特的RSA密钥需要的能量可以煮沸一茶匙的水，而破解228比特的ECC密钥需要的能量能煮沸地球上所有的水。</p>
<h3 id="哈希函数"><a href="#哈希函数" class="headerlink" title="哈希函数"></a>哈希函数</h3><p>应用于梅克尔树、区块指针、挖矿</p>
<p>主要的哈希函数有：</p>
<ul>
<li>MD4&#x2F;MD5（已被攻破）</li>
<li>SHA家族：SHA-1（已被攻破）、SHA-256（比特币）、SHA-384、SHA-512</li>
</ul>
<p>在比特币的系统中，除了公钥和私钥外，由于公钥本身还是太复杂了，因此会对公钥使用哈希函数，生成一个<strong>比特币地址</strong>，通过这个地址来进行交易。</p>
<p><img src="https://s4.ax1x.com/2022/03/02/b8Y1Fx.jpg" srcset="/img/loading.gif" lazyload alt="b8Y1Fx.jpg"></p>
<h2 id="共识机制"><a href="#共识机制" class="headerlink" title="共识机制"></a>共识机制</h2><p>拜占庭将军问题：一组拜占庭将军分贝率军围困一座易守难攻的城池。他们的行动只有进攻或撤退，并且他们必须行动一致，否则会损失惨重。他们会通过信使来互相联系，将自己的信息告知给其他将军。每个将军通过自己收到的信息来决定进攻还是撤退。</p>
<p>在是个分布式系统里的模型，可以用来归纳共识机制面临的问题：</p>
<ul>
<li>信使送信太慢：延时</li>
<li>信使被中途截杀：信息丢失</li>
<li>将军阵亡：服务器宕机</li>
<li>叛变、发送假消息、伪造他人信件：攻击者</li>
<li>策反：贿赂其他节点，发动合谋攻击</li>
</ul>
<h3 id="安全模型"><a href="#安全模型" class="headerlink" title="安全模型"></a>安全模型</h3><p> 根据这个模型，可以按照<strong>安全等级</strong>分出三种安全模型：</p>
<ul>
<li><p><strong>非拜占庭容错模型</strong>：没有攻击者，所有节点都安全可靠</p>
<p>错误类型：消息丢失、重复、延时；服务器宕机、通信协议不可靠</p>
</li>
<li><p><strong>拜占庭容错模型</strong>：存在攻击者，节点之间互不可信</p>
<p>错误类型：非拜占庭容错；攻击者篡改消息内容</p>
</li>
<li><p><strong>经济模型</strong>：存在有经济实力的攻击者</p>
<p>攻击类型：大量购买硬件资源试图攻击；贿赂其他节点发动合谋攻击</p>
</li>
</ul>
<h3 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h3><p>根据FLP定理和CAP定理，在一个异步的分布式系统中无法达成强一致性。那么有哪些解决方案呢？</p>
<ul>
<li>非拜占庭容错：适用于分布式数据库<ul>
<li>共识机制：Paxos、Raft等</li>
<li>性能较高，容错性较差</li>
</ul>
</li>
<li>拜占庭容错：适用于分布式账本（区块链）<ul>
<li>共识机制：PoW、PoS、DPos、PBFT</li>
<li>容错性较高，性能较差</li>
<li>设计思路：<ul>
<li>提高作恶的成本，降低错误出现的概率</li>
<li>在允许一定恶意节点存在的前提下，依旧实现账本一致</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="实用拜占庭容错算法"><a href="#实用拜占庭容错算法" class="headerlink" title="实用拜占庭容错算法"></a>实用拜占庭容错算法</h4><p>PBFT是目前解决拜占庭容错问题最高的方法，将原有的指数级降到多项式级。</p>
<p>可以容忍少于1&#x2F;3的节点作恶，而且参与的节点越多，作恶难度越大，性能越差。</p>
<p>适用于有强一致性要求的联盟链、私有链，或者节点数量固定的公有链，如DPOS公链。以为算法要求每次产生新区块，其他所有的区块必须在规定时间内给出反馈，如果超过2&#x2F;3节点都认可，那么就达成强一致，这个区块就再也无法改动了。</p>
<h3 id="比特币类共识机制的特点"><a href="#比特币类共识机制的特点" class="headerlink" title="比特币类共识机制的特点"></a>比特币类共识机制的特点</h3><ul>
<li><p><strong>随机性</strong></p>
<p>记账者们解决数学谜题，竞争记账权的过程，可以看做随机选择的过程。由于比特币的一笔交易一般需要6个区块才能最终确认，而作恶者被随机选中6次的概率是很低的。</p>
<p>但是，随机性想要生效，前提是选择是真随机，或者至少不能被预测或者操控。如果作恶者能掌握大部分的节点或者算力，那么还是可以作恶。</p>
</li>
<li><p><strong>抗女巫攻击</strong>：如何抵御通过刷小号方式来提高被选中概率的作恶手法。</p>
<p>大致思路为提高创建账号或者加入共识需要的成本。挖矿就是一种工作量的门槛，光有小号没有算力是无法作恶的。或者就是对资源设置门槛，也就是使用权益证明。</p>
</li>
<li><p><strong>激励机制</strong></p>
<p>奖励诚实的参与者，惩罚作恶者的反激励机制。</p>
</li>
</ul>
<h4 id="工作量证明（PoW）"><a href="#工作量证明（PoW）" class="headerlink" title="工作量证明（PoW）"></a>工作量证明（PoW）</h4><p>挖矿的谜题就像个模仿，解密很苦难，但是结果是否正确很容易检验。</p>
<p>至于难度目标到底是多少，则是由比特币的程序每隔2016个区块就自动调节一次的，根据之前出块速度和之前难度目标反推全网算力，再根据全网算力设置一个合适的难度目标，让全网平均<strong>10分钟</strong>能出一个块。这样一来，**谁的计算能力强，谁在单位时间内计算次数多，谁就有更大的概率试出符合要求的哈希值，获得记账权和比特币奖励，这种共识机制也被称为工作量证明(PoW)**。</p>
<h4 id="权益证明（POS）"><a href="#权益证明（POS）" class="headerlink" title="权益证明（POS）"></a>权益证明（POS）</h4><ul>
<li><p>PoW：拥有算力越大，出块概率越大</p>
</li>
<li><p>PoS：锁定的代币越多，出块概率越大</p>
</li>
</ul>
<p>抗女巫攻击：通过资源门槛来，因为创建再多的小号，作恶者拥有的代币总量是不变的。</p>
<p>随机性：通过VDF、VRF等函数生成随机数。</p>
<p>激励机制：挖出区块的奖励；手续费</p>
<p>以太坊目前还在采用PoW，但是在2.0版本会采用PoS。</p>
<h4 id="授权权益证明（DPOS）"><a href="#授权权益证明（DPOS）" class="headerlink" title="授权权益证明（DPOS）"></a>授权权益证明（DPOS）</h4><ul>
<li><p>PoS：用代币给区块投票</p>
</li>
<li><p>DPoS：用代币给节点投票</p>
</li>
</ul>
<p>持币者通过锁定代币获得一定投票权，投票给节点候选人，得票排名靠的节点代为行使出块权利，轮流出块。</p>
<p>优势：</p>
<ul>
<li>让专业的人来做专业的事，网络增加安全稳定，并且不是所有的个人用户都愿意承担记账的义务</li>
<li>控制记账者的数量，大大降低了达成共识需要的节点数，可以极大提高性能，加快达成共识的速度（每笔交易确认的速度）</li>
</ul>
<p>劣势：去中心化程度低</p>
<h1 id="比特币"><a href="#比特币" class="headerlink" title="比特币"></a>比特币</h1><p>Bit Coin，代号（BTC），于2008年以论文形式发布，2009年创世区块诞生。</p>
<p>定位是一种<strong>点对点的电子现金系统</strong>，可以消除目前线上交易对<strong>可信第三方</strong>的依赖。</p>
<h2 id="基本规则："><a href="#基本规则：" class="headerlink" title="基本规则："></a>基本规则：</h2><ul>
<li>每10分钟左右会产生一个新的区块，<strong>一定数量</strong>的比特币会奖励给创建者。</li>
<li>奖励数量<strong>每4年减半1次</strong>，最初创建一区块奖励50btc。产生到21万个区块后降为25btc，后面一次对半递减。</li>
<li>比特币的上限约为<strong>2100万</strong>个，预计<strong>2140</strong>年左右全部挖出。目前已经挖出近<strong>1800万</strong>个。</li>
</ul>
<h3 id="区块链和比特币之间的关系"><a href="#区块链和比特币之间的关系" class="headerlink" title="区块链和比特币之间的关系"></a>区块链和比特币之间的关系</h3><p>区块链是支持比特币作为一款应用的底层技术，提供了<strong>分布式账本技术</strong>，解决了交易各方的<strong>信任问题</strong>。</p>
<h2 id="如何运行"><a href="#如何运行" class="headerlink" title="如何运行"></a>如何运行</h2><p>假设有交易双方发生了交易，他们会将这比交易的信息全网广播，使分布式账本的状态发生改变。</p>
<p>记账者负责记录一段时间内的<strong>交易信息</strong>，一起参与交易的双方<strong>账户状态</strong>，并打包到一个区块中。由于大约每10分钟产生一个新区块，所以可以看做每一个区块就是<strong>一页账单</strong>，记录了这10分钟内发生的交易。区块按照<strong>时间顺序</strong>串联，上一个区块的结尾时的状态紧接着下一个区块开头的状态，就形成了<strong>区块链</strong>。</p>
<h3 id="账户体系"><a href="#账户体系" class="headerlink" title="账户体系"></a>账户体系</h3><p>比特币采用<strong>非对称加密</strong>，公钥作为<strong>账号</strong>，私钥作为<strong>密码</strong>。</p>
<p>随机生成私钥，通过数学加密曲线（如椭圆加密曲线）生成公钥。知道公钥<strong>难以</strong>计算出私钥。</p>
<h3 id="交易发出"><a href="#交易发出" class="headerlink" title="交易发出"></a>交易发出</h3><p>假设A要给B转账，那么A需要：</p>
<ul>
<li>一个交易单，内容包括：付款人A，收款人B，比特币数量，来源（A的余额）。</li>
<li>A对交易单进行<strong>数字签名</strong></li>
<li>B用A的公钥验证数字签名。</li>
</ul>
<h3 id="挖矿：争夺记账权"><a href="#挖矿：争夺记账权" class="headerlink" title="挖矿：争夺记账权"></a>挖矿：争夺记账权</h3><p>网络中有很多记账者，他们在自己的账单里记录了上一页账单的哈希值（以此证明账单的连续性），监听别人广播的交易信息并记录在自己的账单中。</p>
<p>那么问题来了，那么多记账者，每个人都有自己版本的账单，到底谁的账单会被公认为下一页账单呢？比特币解决这个问题的方式是<strong>数学谜题</strong>。</p>
<p><code>H ( nonce || prev_hash || tx || tx ... || tx ) &lt; target</code> </p>
<p>（随机值+上个区块的哈希值+记录的交易）取哈希值，结果要满足一个很难达到的条件。记账者需要不断尝试随机数，第一个尝试成功的人拥有记账权。</p>
<h3 id="记账验证"><a href="#记账验证" class="headerlink" title="记账验证"></a>记账验证</h3><p>记账者获得记账权后，发布的区块需要被全网检验后才能接收，成为被公认的下一页账单。</p>
<p>其他记账者会检查：</p>
<ul>
<li>验证上一个区块的哈希值，和自己记录的是否一样。</li>
<li>验证每一笔交易是否合法：付款人和收款人的签名，交易余额是否足够</li>
<li>验证本页的哈希值是否有效</li>
</ul>
<p>通过验证后，获胜者可以获得奖励：</p>
<ul>
<li>区块奖励：挖出一个区块会奖励一定数量的比特币</li>
<li>交易手续费：这一个区块中记录的所有交易，都能从中获得一笔手续费。</li>
</ul>
<h3 id="交易模型：UTXO模型"><a href="#交易模型：UTXO模型" class="headerlink" title="交易模型：UTXO模型"></a>交易模型：UTXO模型</h3><p>UTXO: Unspent Transaction Output 未花费的交易输出</p>
<p>重点在于记录<strong>交易</strong>而非<strong>余额</strong>：</p>
<ul>
<li>传统账户交易：只看余额在交易前后的状态，加减账户的余额数字。</li>
<li>基于UTXO的交易：只记录交易过程，下一笔交易的输入必须是之前交易的输出</li>
</ul>
<p>比如A要给B转账20btc，账本中记录的不是A的余额减少了20，B增加了20。而是50个btc从A点流出，其中20流入了B，30流入了A。</p>
<p>用上一笔的流入作为下一笔的流出，并且可能是多笔流入一起作为下一笔流出。</p>
<p>因此在比特币交易中，没有<strong>余额</strong>的概念，上一次交易的流入减去的币就是余额。在花费的时候，必须知名每一笔余额的来源，而且必须全部花完，多余部分流回自己的地址，也可以每次都创建一个新的地址，这又是一个不符合直觉的地方。没有账户系统，每个人可以对应多个地址。</p>
<h4 id="双花问题"><a href="#双花问题" class="headerlink" title="双花问题"></a>双花问题</h4><p>电子货币容易出现<strong>双花问题</strong>。A可以同时声称自己将一比钱转给了B和C。比特币使用<strong>分叉与最长链原则</strong>来解决。</p>
<p>A如果要双花，那么他会将这两笔交易都广播。由于网络状况，不同的记账者接收到这两笔交易的先后顺序不同，并且收到一种一条后就不会再记录另一条。假设有两个记账者分别记录的给B和C的交易，并且几乎同时完成了数学谜题，那么他们会各自产生新区块，并且都认为自己是应该被公认的，这样就产生了<strong>分叉</strong>。</p>
<p>不同的分叉产生了不同的账本，只有记账者认可数最多的版本，才是公认的账本。如何体现认可数呢？通过区块链的<strong>长度</strong>。记账者会在他们认可的账本后面继续记账，因此越多人认可的区块链，有越多人参与，经过一段时间后该链的长度就会明显长与其他分叉，成为公认的账本。在比特币中，大家一般等待<strong>6个区块</strong>来确认一笔交易。注意，这只是一个<strong>约定俗成</strong>的数字。</p>
<h1 id="以太坊"><a href="#以太坊" class="headerlink" title="以太坊"></a>以太坊</h1><blockquote>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1Vt411X7JF">北京大学肖臻老师《区块链技术与应用》公开课</a></p>
</blockquote>
<p>Ethereum，数字货币代号<strong>ETH</strong>，是区块链2.0应用的代表。相比1.0：</p>
<table>
<thead>
<tr>
<th align="left">区块链1.0（以比特币为代表）</th>
<th>区块链2.0（以太坊为代表）</th>
</tr>
</thead>
<tbody><tr>
<td align="left">非图灵完备：只能执行有限类型指定</td>
<td>图灵完备的</td>
</tr>
<tr>
<td align="left">不支持智能合约</td>
<td>支持智能合约</td>
</tr>
<tr>
<td align="left">定位于支付网络，数字货币</td>
<td>定位于平台，可以衍生出各种应用</td>
</tr>
</tbody></table>
<p>图灵完备：指机器执行任何其他可编程计算机能够执行计算的能力。一切可计算的问题都能解决，这样的虚拟机或者编程语言就叫图灵完备。</p>
<p>比特币的系统是图灵不完备的，而以太坊的智能合约系统是图灵完备的，实现了<strong>可编程的区块链</strong>，可以创建自己的应用，因此才说定位于<strong>平台</strong>。</p>
<h2 id="智能合约"><a href="#智能合约" class="headerlink" title="智能合约"></a>智能合约</h2><p>传统的非智能合约，需要一个第三方来确保合约执行。</p>
<p>智能合约就是写在区块链上的一串自动执行的代码，一方面它不断地监听预置触发条件是否达到，如果达到了则执行预置的行动。</p>
<h3 id="DApp"><a href="#DApp" class="headerlink" title="DApp"></a>DApp</h3><p>以智能合约作为后台，加上数据库和前段界面后，就形成了DApp（去中心化的APP）。与传统APP最大的区别在于去中心化，说明其后端和数据库不是在某个中心化服务器，而是放在区块链上的。</p>
<h2 id="交易模型"><a href="#交易模型" class="headerlink" title="交易模型"></a>交易模型</h2><p>以太币的交易相较于比特币更加符合直觉，因为加入了<strong>账户系统</strong>。</p>
<p>因此天然避免双花问题，因为直接从余额中扣除两次即可。但是也引来了新的攻击——<strong>重放攻击</strong>。因此需要在交易中加入<strong>nonce</strong>，表示这个账户的第几次交易，并且由数字签名保护。</p>
<h3 id="账户类型"><a href="#账户类型" class="headerlink" title="账户类型"></a>账户类型</h3><p>以太坊中有两种账户：</p>
<ul>
<li>外部账户：由私钥来控制，包含信息有余额、交易次数（nonce）</li>
<li>合约账户：<ul>
<li>包含信息有：balance、nonce（表示调用其他合约的次数）、代码、存储（storage）</li>
<li>不能够主动发起交易。以太坊规定交易只能由外部账户发起。</li>
</ul>
</li>
</ul>
<h2 id="状态树"><a href="#状态树" class="headerlink" title="状态树"></a>状态树</h2><p>维护地址到状态的映射。以太坊中的地址是160位的，也就是40个16进制的整数。</p>
<ul>
<li>为什么不用哈希表维护这个映射：某些账户状态的更新需要重新计算整个哈希表的hash值，不能像merkle树那样只修改受到影响的部分。</li>
<li>为什么不使用merkle树：因为merkle树不提供快速查找的功能。而且如果不规定底层叶子节点的排序问题，那么每个全节点构造的merkle树可能是不一样的。比特币中其实也没有规定顺序，每个记账者监听到的交易的顺序是不同的，但是由于会竞争记账权，因此最后大家都遵循到记账权的人所记录的版本。</li>
<li>为什么不使用排序的merkle树：地址生成是随机的，很可能新增地址需要从中间插入，那么也会影响到大半个merkle树。</li>
</ul>
<p>以太坊实际使用的是<strong>trie</strong>结构，也就是我们熟知的<strong>前缀树</strong>。地址由40个16进制数组成，最后还需要一个结束标志符，则branching factor是17。</p>
<p>trie有很多很好的性质：</p>
<ul>
<li>无论插入节点的顺序是什么，构造出来的树都是一样的</li>
<li>只要地址不发生碰撞，那么每个地址一定对应唯一的分支</li>
<li>更新的局部性很好</li>
</ul>
<img src="C:\Users\JackZhu\AppData\Roaming\Typora\typora-user-images\image-20220310130157561.png" srcset="/img/loading.gif" lazyload alt="image-20220310130157561" style="zoom:50%;" />

<p>但是有个问题：当节点数量很少的时候，很多分支都是“一脉单传”的，有压缩的空间。以太坊使用的结构对trie进行了路径压缩，形成了<strong>Patricia trie</strong>。他可以将上面的树压缩成下面的状态。</p>
<img src="C:\Users\JackZhu\AppData\Roaming\Typora\typora-user-images\image-20220310130130956.png" srcset="/img/loading.gif" lazyload alt="image-20220310130130956" style="zoom:50%;" />

<p>Patricia trie在键值分布比较稀疏的时候效果好。对于以太坊地址而言，这个场景就非常适合，因为用户都可以在本地创建地址，为了避免地址碰撞，只能将地址规定得足够长。</p>
<p>merkle tree和binary tree的区别就是使用了哈希指针。那么merkle Patricia tree就是在Patricia tree的基础上使用了哈希指针。和比特币的merkle tree一样，merkle Patricia tree也提供了避免篡改、merkle proof的功能。</p>
<p>以太坊最终使用的是<strong>Modified MPT</strong>，shared nibbles表示共享的前缀。</p>
<img src="C:\Users\JackZhu\AppData\Roaming\Typora\typora-user-images\image-20220310131320802.png" srcset="/img/loading.gif" lazyload alt="image-20220310131320802" style="zoom:50%;" />

<p>在新的区块中，有些节点的信息发生了变化，这些变化不是在原地改动的，而是在新的区块中，没有修改的部分指向原区块的数据，修改的部分存在新区块中。Storage tree也是一个MPT，其中按键值对的形式保存，可以看做是程序中的<strong>变量</strong>。</p>
<img src="C:\Users\JackZhu\AppData\Roaming\Typora\typora-user-images\image-20220310132852516.png" srcset="/img/loading.gif" lazyload alt="image-20220310132852516" style="zoom:50%;" />

<p>为什么状态树要保存全局信息，而不是只保存当前区块内的交易涉及到的信息：因为假如A给B转账，需要知道A和B的状态。如果账户很久没有发生过交易，那么需要往前扫描很多区块才能找到；如果是新账户，那么要扫描到创世区块才能确定是新账户。</p>
<h3 id="交易树和收据树"><a href="#交易树和收据树" class="headerlink" title="交易树和收据树"></a>交易树和收据树</h3><p>由于智能合约的复杂性，所以以太坊引入这两种树来保存交易信息。这两个树不需要保存全局的信息，只包含新区块中产生的交易。理论上只需要使用普通的merkle tree，但实际使用MPT。</p>
<p>交易树的键值是交易在发布区块时的序号。</p>
<h2 id="发币和ICO"><a href="#发币和ICO" class="headerlink" title="发币和ICO"></a>发币和ICO</h2><p>为什么市面上有那么多数字货币？</p>
<p>因为他们很多是基于以太坊上的<strong>ERC20协议</strong>发行的代币。该协议允许用户自定义并发行Token，该Token的交易会被监听并记录在以太坊区块链上，因此其安全性和可信度等同于以太币ETH。该种代币发行方式有开源的代码模板可以借鉴，因此技术门槛比较低，吸引了各种人来发币。</p>
<p>其实很多代币的发行是一种<strong>众筹模式</strong>。比如一个团队打算开发一款DApp，他们可以先发币，声称该货币会在他们DApp中有作用，但是目前还在开发阶段。别人可以先买币，项目团队用买币的收入来开发，等开发完成后，这种货币也会有价值了，那么前期买币的人就获得了收益。这种就是Initial Coin Offering（<strong>首次发行代币</strong>）。</p>
<p>代币在区块链上火交易所内迅速流通，流动性媲美上市。但是其极强的流动性和该时期监管的缺失造成了极强的炒作性。大量散户涌入也加剧了盲目投机，催生出了一批借发币形式来圈钱的假项目，使发出的代币沦为“空气币”。</p>
<h2 id="以太币ETH的作用"><a href="#以太币ETH的作用" class="headerlink" title="以太币ETH的作用"></a>以太币ETH的作用</h2><ul>
<li><p>以太坊上用于支付交易手续费和运算服务的介质</p>
<ul>
<li><p>交易手续费：同比特币等电子现金系统，是给记账者的奖励</p>
</li>
<li><p>运算服务费：支付费用来运算智能合约或者其他以太坊上的程序（因为在以太坊上，节点不仅要负责记账，还需要负责智能合约的运算）</p>
</li>
</ul>
</li>
<li><p>ICO众筹中最常用的募资款项</p>
</li>
<li><p>加密货币交易市场中的主流交易对（不同代币之间的价值媒介）</p>
</li>
</ul>
<h2 id="应用"><a href="#应用" class="headerlink" title="应用"></a>应用</h2><p>目前有2个比较有前景的应用方向</p>
<h3 id="1-去中心化金融DeFi"><a href="#1-去中心化金融DeFi" class="headerlink" title="1. 去中心化金融DeFi"></a>1. 去中心化金融DeFi</h3><p>消除传统金融中的中介方、繁琐的手续和交易成本。</p>
<p>支付：不再依赖银行的账户系统，而是点对点支付，在跨国支付场景下尤为轻便<br>借贷：抵押资产借钱，在传统金融中只能抵押给银行等放贷机构，而智能合约的信用使得普惠借贷成为可能。<br>交易：去中心化交易所，链上撮合交易，无中心化风险（删库跑路）</p>
<h3 id="2-去中心化自治组织DAO"><a href="#2-去中心化自治组织DAO" class="headerlink" title="2. 去中心化自治组织DAO"></a>2. 去中心化自治组织DAO</h3><p>公司一般会有自己的章程，但是现实执行中未必会遵守。而DAO可以实现编程化的组织管理，即规则公开透明且无法篡改，满足条件自动执行，由程序替代人为管理。 </p>
<p>这样的特性也可以支持分布式协作。我们可以不需要认识组织内的成员，只需要认可规则，就可以一起协作。</p>
<h2 id="以太坊2-0"><a href="#以太坊2-0" class="headerlink" title="以太坊2.0"></a>以太坊2.0</h2><ul>
<li><p>共识机制切换：从PoW更换为POS</p>
</li>
<li><p>性能提升：采用分片技术，实现性能横向扩展</p>
</li>
<li><p>两条链：将于以太坊1.0并行存在，后期可能合并</p>
</li>
</ul>
<h1 id="zkSync"><a href="#zkSync" class="headerlink" title="zkSync"></a>zkSync</h1><blockquote>
<p>This video [L2 scalability and zkSync (Edcon talk) ](<a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=el-9YYGN1nw&t=97s">L2 scalability and zkSync (Edcon talk) - YouTube</a>)is from the website of zkSync</p>
</blockquote>
<p>This video talks about scalability problem. In the speaker’s opinion, it is hard to scale blockchain because the core value propositon of layer 1 is resilience. The way that BitCoin and Etherum reach resilience is decentralization. </p>
<p>However, in order to ensure security in such an open system, every transactioin executed every L1 node should be verified, rather than easily trusted. Including more nodes in the system requires more verification, and this could be bad for scalability. Only increasing throughput will rise the requirement of nodes, which leads to less qualified nodes. Therefore, the scalability means increasing throughput without increasing node load.</p>
<p>There are two way to do this:</p>
<ul>
<li>Sharding: not verify every transaction, but only a few of them.</li>
<li>Compression: verify a larger amount of transcations by spending the same amount of computational resources.</li>
</ul>
<p>Most of technologies, no matter they belong to Sharding or Compression, have <strong>data availbility problem</strong>. Most of them keep data off-chain, which makes it possible to withhold the data. <strong>Optimisitc rollup</strong> and <strong>zkRollup</strong> keep data on-chain. With rollup technology, the levels of security and usability are very close to mainnet, but the cost is that scalability boost is capped at 100x compared to mainnet. </p>
<p>key words:</p>
<ul>
<li><p><strong>zK</strong>：zero-knowledge proofs</p>
</li>
<li><p><strong>Layer2</strong>：基于以太坊主网的系统，为了对主网进行扩展</p>
</li>
<li><p><strong>zkSync</strong>：A Layer 2 scaling solution on Ethereum that offers low gas and fast transactions, without compromising on security. </p>
</li>
<li><p><strong>Rollup</strong>：Layer2 方案之一，也叫卷叠，通过将以太坊主网上交易的计算和存储转移至 Layer2 处理并压缩，再将压缩后的数据上传至以太坊主网以拓展以太坊性能。</p>
</li>
<li><p>ZK Rollup：采用零知识证明的 Rollup 方案，和其他 Rollup 的不同之处在于采用 zkSNARK 算法（一种零知识证明算法）压缩数据。</p>
<p>zkRollup（zkSync 将其所采用的 ZK Rollup 写作 zkRollup）通过将每笔交易压缩后的数据传到以太坊主网上，保证数据的有效性和可用性，使 zkSync 网络具备和以太坊主网同等的安全性。</p>
</li>
<li><p><strong>zKSNARK</strong>：指的是一种证明结构，其中人们可以证明拥有某些信息，例如密钥，而无需透露该信息，并且证明者和验证者之间没有任何相互作用。</p>
</li>
</ul>
<h4 id="Layer2"><a href="#Layer2" class="headerlink" title="Layer2"></a>Layer2</h4><p>为了解决以太坊的可拓展性问题，开发者提出了两个方向的解决方案，Layer2 和分片（Eth2 的一个重要升级）。Layer2 字面意思是二层网络，相对的，当前的以太坊主网也称为一层网络（Layer1），二层网络也就是基于当前以太坊主网的一个系统。</p>
<p>Layer2 方案主要是从减轻 Layer1 负担的角度出发，将 Layer1 的大量计算需求搬到 Layer2 上。</p>
<p>主流 Layer2 方案有 ZK Rollup、Optimistic Rollup、Plasma、State Channels（状态通道）、Validium 等。</p>
<h4 id="Rollups"><a href="#Rollups" class="headerlink" title="Rollups"></a>Rollups</h4><p>Rollups 是一种「混合」的 Layer2 方案。<strong>Rollups 将计算（以及状态存储）转移至链下，但同时将每笔交易的部分数据保留在链上。</strong></p>
<p>为了提高效率，他们使用了不少 fancy 的压缩技巧，尽可能地使用「计算」代替「数据」。其结果是系统的扩容仍然受限于底层区块链的数据带宽，但效率是可观的：Ethereum ERC20 代币转账成本约为 45,000 gas，而 Rollup 中的 ERC20 代币转账仅使用 16 字节的链上空间，成本低于 300 gas。</p>
<p>事实上，数据上链是关键（注意：将数据放在 IPFS 上是行不通的，因为 IPFS 不提供任何给定数据是否可用的共识，所以数据必须放到区块链上）。将数据放在链上并获得共识，如果任何人愿意，他们可以在本地处理 rollup 中的所有操作，从而允许他们监测欺诈交易，请求提款，或亲自生成 transaction batches。</p>
<p>因为没有数据可用性问题，所以恶意或离线运营者所造成的损失会更少（比如他们不能造成 1 周的延迟），从而为谁有权发布 batches 打开了更大的设计空间，并简化 rollups 系统。最重要的是，没有数据可用性问题也意味着不再需要将资产映射到 owners。</p>
<p>这是 Ethereum 社区对 rollups 比以往的 Layer2 扩容方案更兴奋的关键原因：<strong>Rollups 是完全通用的，我们甚至可以在 rollup 内运行一个 EVM，使得现有的 Ethereum 应用不必编写过多新的代码就可以迁移到 rollups 上。</strong></p>
<h4 id="ZK-Rollup"><a href="#ZK-Rollup" class="headerlink" title="ZK Rollup"></a>ZK Rollup</h4><p>ZK 是 Zero Knowledge（零知识）的缩写，零知识证明是指证明者能够在不向验证者提供任何有用信息的情况下，使验证者相信某个论断是正确的。</p>
<p>Rollup 中文叫做卷叠，是一种以太坊扩容方案的统称。Rollup 通过将链上计算转移至链下（二层网络），但同时将每笔交易的部分数据保留在链上达到提升以太坊网络性能的目的。</p>
<p>ZK Rollup &#x3D; 交易压缩 + 零知识证明（zk-SNARK）</p>
<p>ZK Rollup 核心思想是在链下达成交易共识，并通过零知识证明算法压缩交易数据，保证链下交易状态的有效性，最后将数据同步至以太坊主网。</p>
<h4 id="Optimistic-rollups-VS-ZK-rollups"><a href="#Optimistic-rollups-VS-ZK-rollups" class="headerlink" title="Optimistic rollups VS ZK rollups"></a>Optimistic rollups VS ZK rollups</h4><ul>
<li><p><strong>Optimistic rollups</strong>，采用欺诈性证明：rollup 合约会跟踪历史的 state roots 和每一个 batch 的哈希值。如果有人发现某个 batch 的 post-state root 不正确，那么他们可以向合约提交证明，证明该 batch 计算错误。合约验证该证明有效后，会对该 batch 和之后的所有 batch 进行回滚。</p>
</li>
<li><p><strong>ZK rollups</strong>，采用有效性证明：每一个 batch 都包含一个称为 ZK-SNARK 的密码学证明（例如采用 PLONK 协议），它可以证明 post-state root 是执行该 batch 的正确结果。无论计算量有多大，合约都可以迅速地在链上验证证明。</p>
</li>
</ul>
<h4 id="zK-SNARK"><a href="#zK-SNARK" class="headerlink" title="zK-SNARK"></a>zK-SNARK</h4><p>Zk-SNARK是一个首字母缩略词，代表”零知识简洁的非交互式知识论证”。zk-SNARK是一种加密证明，允许一方证明其拥有某些信息而不泄露该信息。使用在交易发生之前创建的密钥可以证明此证明。它被用作加密货币<a target="_blank" rel="noopener" href="https://www.investopedia.com/terms/z/zcash.asp">Zcash</a>协议的一部分。</p>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/%E7%AC%94%E8%AE%B0/">笔记</a>
                    
                  </div>
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/%E5%8C%BA%E5%9D%97%E9%93%BE-%E6%AF%94%E7%89%B9%E5%B8%81-%E4%BB%A5%E5%A4%AA%E5%9D%8A/">区块链, 比特币, 以太坊</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">
                  
                    本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！
                  
                </p>
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/algorithm/binary-search/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">二分查找的细节问题</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/algorithm/nowcoder/">
                        <span class="hidden-mobile">牛客网TOP101</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
  </div>
  
  <div class="statistics">
    
    

    
      
        <!-- LeanCloud 统计PV -->
        <span id="leancloud-site-pv-container" style="display: none">
            总访问量 
            <span id="leancloud-site-pv"></span>
             次
          </span>
      
      
        <!-- LeanCloud 统计UV -->
        <span id="leancloud-site-uv-container" style="display: none">
            总访客数 
            <span id="leancloud-site-uv"></span>
             人
          </span>
      

    
  </div>


  

  
</footer>


  <!-- SCRIPTS -->
  
  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  <script  src="/js/local-search.js" ></script>



  
    <script  src="/js/img-lazyload.js" ></script>
  



  



  
    <script  src="https://cdn.jsdelivr.net/npm/tocbot@4/dist/tocbot.min.js" ></script>
  
  
    <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.js" ></script>
  
  
    <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4/anchor.min.js" ></script>
  
  
    <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js" ></script>
  




  <script defer src="/js/leancloud.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
        typing(title);
      
    })(window, document);
  </script>












  

  

  

  

  

  





<!-- 主题的启动项 保持在最底部 -->
<script  src="/js/boot.js" ></script>


</body>
</html>
